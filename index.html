<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diesel Pro - Tablero de Taller</title>

<style>

body {
    margin: 0;
    background-color: #0f172a;
    color: #ffffff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* CABECERA */

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #1e293b;
    padding: 20px 50px;
}

.logo-container {
    display: flex;
    align-items: center;
    gap: 20px;
}

.logo {
    background-color: #f59e0b;
    padding: 10px 20px;
    font-size: 28px;
    font-weight: bold;
    border-radius: 8px;
}

.title {
    font-size: 36px;
    font-weight: bold;
}

.clock {
    font-size: 42px;
    color: #38bdf8;
    font-family: monospace;
}

/* CONTENEDOR EN FILAS */

.grid-container {

    display: flex;
    flex-direction: column;
    gap: 20px;

    padding: 40px;

}

/* TARJETA EN FORMATO FILA */

.card {

    display: flex;
    flex-direction: row;

    justify-content: space-between;
    align-items: center;

    background-color: #1e293b;

    border-left: 12px solid #f59e0b;

    padding: 25px;

    border-radius: 10px;

    font-size: 26px;

}

/* EN PROCESO */

.card.en-proceso {

    border-left-color: #3b82f6;

    background-color: #172554;

}

/* COLUMNAS */

.col {

    flex: 1;

}

.empresa {

    font-size: 32px;
    font-weight: bold;

}

.componente {

    color: #94a3b8;

}

.operario {

    color: #fbbf24;
    font-weight: bold;

}

.estado {

    font-size: 22px;
    font-weight: bold;

    padding: 10px 20px;
    border-radius: 20px;

    background-color: #fef3c7;
    color: #b45309;

}

.card.en-proceso .estado {

    background-color: #dbeafe;
    color: #1d4ed8;

}

.empty-state {

    text-align: center;
    font-size: 40px;
    padding: 100px;
    color: #475569;

}

</style>

</head>

<body>

<div class="header">

<div class="logo-container">

<div class="logo">DP</div>

<div class="title">TAREAS EN TALLER</div>

</div>

<div class="clock" id="reloj"></div>

</div>

<div class="grid-container" id="contenedor-tareas">

<div class="empty-state">

Cargando tareas...

</div>

</div>

<script>
<script>
// --- Notaci√≥n espec√≠fica: Reloj ---
function actualizarReloj() {
    document.getElementById('reloj').textContent = new Date().toLocaleTimeString('es-PE');
}
setInterval(actualizarReloj, 1000);
actualizarReloj();

// --- Notaci√≥n espec√≠fica: Renderizado visual ---
function renderizarTareas(tareas) {
    const contenedor = document.getElementById('contenedor-tareas');
    contenedor.innerHTML = '';

    if (!tareas || tareas.length === 0) {
        contenedor.innerHTML = '<div class="empty-state">NO HAY TAREAS PENDIENTES</div>';
        return;
    }

    tareas.forEach(tarea => {
        const enProceso = tarea.estado === "EN_PROCESO";
        const card = document.createElement("div");
        card.className = `card ${enProceso ? "en-proceso" : ""}`;
        card.innerHTML = `
            <div class="col empresa">${tarea.empresa}</div>
            <div class="col componente">${tarea.componente}</div>
            <div class="col operario">üë§ ${tarea.operario_asignado || 'Sin asignar'}</div>
            <div class="estado">${enProceso ? "EN PROCESO" : "PENDIENTE"}</div>
        `;
        contenedor.appendChild(card);
    });
}

// --- M√©todo de Disyunci√≥n: Conexi√≥n Real a TiDB ---
const API_URL = "https://us-east-1.data.tidbcloud.com/api/v1beta/app/dataapp-sjoCrdWZ/endpoint/tareas";
const PUBLIC_KEY = "C2UDOK40";
const PRIVATE_KEY = "a0c7bcb7-bf10-4b88-a53a-c4a922f72aa3";
const AUTH_HEADER = "Basic " + btoa(PUBLIC_KEY + ":" + PRIVATE_KEY);

async function obtenerTareasEnVivo() {
    try {
const respuesta = await fetch(API_URL, {
    method: "GET",
    mode: "cors", // <--- Agregamos esto expl√≠citamente
    headers: {
        "Authorization": AUTH_HEADER,
        "Accept": "application/json"
    }
});
        
        const json = await respuesta.json();
        
        // Extraemos exclusivamente el arreglo de filas (rows)
        const tareasReales = json.data.rows;
        
        renderizarTareas(tareasReales);
    } catch (error) {
        console.error("Error de conexi√≥n:", error);
        document.getElementById('contenedor-tareas').innerHTML = '<div class="empty-state">Conectando al servidor... ‚è≥</div>';
    }
}

// Ejecutar inmediatamente y recargar los datos cada 10 segundos
obtenerTareasEnVivo();
setInterval(obtenerTareasEnVivo, 10000);
</script>
</script>

</body>

</html>


